(function(){
		
	console.log('perf-widget script inserted...');

	const holder = document.createElement('div');
	const style = document.createElement('style');
	var output = ``;
	const close = document.createElement('span');
	
	holder.setAttribute('id', 'perf-widget-holder');

	if(window.pWidgeGlobals === undefined){
		window.pWidgeGlobals = {};	
	}

	style.textContent = `

		#perf-widget-holder {
			position: fixed;
			bottom : 20px;
			right : 20px;
			width : 250px;
			max-height : 300px;
			overflow-y: scroll;
			background-color : #333;
			z-index : 2147483647;
			border-radius: 5px;
		    box-shadow: 0 0 5px black;
		    color: white;
		    box-sizing: border-box;
		    padding: 10px;
		    font-size: 16px;
		    padding-bottom: 20px;
		}

		#perf-widget-holder > *{
		    font-weight: 100;
		}

		#perf-widget-holder .close{
		    position: absolute;
		    right: 5px;
		    top: 5px;
		    color: rgba(255,255,255,.5);
		    border: 1px solid white;
		    width: 1em;
		    height: 1em;
		    text-align: center;
		    border-radius: 100%;
		    cursor: pointer;
		    background-size: 50%;
		    background-position: 50%;
		    background-repeat: no-repeat;
		    background-image: url('http://local.ft.com:3000/static/images/cross.png');
		}

		#perf-widget-holder h3:first-of-type{
			margin-top:0;
		}

		#perf-widget-holder h3{
			margin-bottom: 10px;
		}

		#perf-widget-holder li{
			list-style-type: none;
			padding: 0;
			margin: 0;
			font-size: 0.8em;
			display: flex;
		    align-items: center;
		}

		#perf-widget-holder li::before{
		    width: 1em;
		    height: 1em;
		    display: inline-block;
		    content: "";
		    margin-right: 0.5em;
		    background-size: 100%;
		    padding-top: 1px;
		    background-position: 50%;
		    background-repeat: no-repeat;
		    background-image: url('http://local.ft.com:3000/static/images/unsure.png');
		}

		#perf-widget-holder li.concern-false::before{
		    background-image: url('http://local.ft.com:3000/static/images/check.png');
		}

		#perf-widget-holder li.concern-true::before{
			background-image: url('http://local.ft.com:3000/static/images/issue.png');
		}

	`;

	function resetTimeout(){
		if(pWidgeGlobals.tO !== undefined){
			clearTimeout(pWidgeGlobals.tO);		
		}
	}

	function closeDialog(){
		holder.parentNode.removeChild(holder);
	}

	{{#if data}}

		{{#if data.Performance}}
		
			console.log('We have perf data');
			output += `<h3>Performance</h3>`;

			output += `{{#each data.Performance}} <li class="concern-{{ concern }}">{{text}}</li> {{/each}}`;

		{{/if}}

		{{#if data.security}}
		
			console.log('We have security data');

			output += `<h3>Security</h3>`;

			output += `{{#each data.security}} <li class="concern-{{ concern }}">{{text}}</li> {{/each}}`;

		{{/if}}

		{{#if data.accessibility}}
		
			console.log('We have accessibility data');
			output += `<h3>Accessibility</h3>`;

			output += `{{#each data.accessibility}} <li class="concern-{{ concern }}">{{text}}</li> {{/each}}`;
		
		{{/if}}

		close.setAttribute('class', 'close');

		close.addEventListener('click', function(){
			resetTimeout();
			closeDialog();
		}, false);

	{{else}}

		output += `{{ message }}`

		resetTimeout();
		pWidgeGlobals.tO = setTimeout(function(){
			closeDialog()
		}, 3000);

	{{/if}}

	holder.innerHTML = output;
	holder.appendChild(close);

	document.head.appendChild(style);
	document.body.appendChild(holder);

}());