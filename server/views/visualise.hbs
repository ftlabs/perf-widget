<!DOCTYPE html>
<html>

	<head>

		<title>FT Labs Perf-Widget</title>
		<link rel="stylesheet" href="https://build.origami.ft.com/v2/bundles/css?modules=o-techdocs@^5.0.1,o-fonts@^1.6.4,o-grid@^4.0.0,o-header@^4.0.0" />

		<style type="text/css">
			html, body {
				font-family: BentonSans;
				margin: 0;
				margin-bottom: 5em;
			}

			th{
				cursor: pointer;
			}

		</style>

	</head>

	<body class="o-techdocs">

		<header data-o-component="o-header" class="o-header">
			<div class="o-header__container">
				<div class="o-header__inner">
					<div class="o-header__primary">
						<div class="o-header__primary__left">
							<a class="o-header__logo o-header__logo--ft" href="http://labs.ft.com">
								<abbr title="Financial Times">FT</abbr>
							</a>
						</div>
					</div>
				</div>
			</div>
		</header>

		<main class="o-techdocs-container">
					
			<div class="o-techdocs-layout">

				<div class="o-techdocs-main o-techdocs-main--fullwidth">

					<h3>All insights for the last 24 hours</h3>

					<div class="o-techdocs-table-wrapper">

						<table>
							<thead>
								<tr><th>Domain</th><th>URL</th><th data-value-type="number">Time</th><th>Provider</th><th>Metric</th><th data-value-type="number">Value</th></tr>
							</thead>
							<tbody>
									
								{{#each results}}
									<tr><td>{{domain}}</td><td>{{url}}</td><td data-info="time">{{date}}</td><td>{{provider}}</td><td>{{name}}</td><td>{{value}}</td></tr>
								{{/each}}

							</tbody>
						</table>

					</div>
				
				</div>

			</div>

		</main>

		<script src="https://build.origami.ft.com/v2/bundles/js?modules=o-techdocs@^5.0.1,o-fonts@^1.6.4,o-grid@^4.0.0"></script>

		<script>

			var table = document.querySelector('table'),
				ths = table.querySelectorAll('thead th'),
				rows = table.querySelectorAll('tbody tr');

			function ascendingSort(a, b){

				if(a < b){
					return -1;
				} else if (b < a){
					return 1;
				} else {
					return 0;
				}

			}

			function descendingSort(a, b){

				if(a < b){
					return 1;
				} else if (b < a){
					return -1;
				} else {
					return 0;
				}
				
			}

			function sortRowsByColumn(idx, ASC, isNumberValue){

				var r = Array.from(rows),
					tbody = table.querySelector('tbody');

				r.sort(function(a, b){

					var aCol = a.childNodes[idx].textContent;
					var bCol = b.childNodes[idx].textContent;

					if(isNumberValue){
						aCol = parseInt(aCol);
						bCol = parseInt(bCol);
					}

					if(ASC){
						return ascendingSort(aCol, bCol);
					} else {
						return descendingSort(aCol, bCol);
					}
				
				});

				tbody.innerHTML = "";
	
				r.forEach(function(row){
					tbody.appendChild(row);
				});

			}

			Array.from(ths).forEach(function(th, idx){

				(function(columnIndex){

					th.addEventListener('click', function(){
						console.log(this, columnIndex);

						if(this.getAttribute('data-order') === null || this.getAttribute('data-order') === "DES"){
							this.setAttribute('data-order', 'ASC');
						} else {
							this.setAttribute('data-order', 'DES');
						}

						sortRowsByColumn(columnIndex, this.getAttribute('data-order') === "ASC", this.getAttribute('data-value-type') === "number")
					}, false);

				})(idx)

				
			});


		</script>

	</body>

</html>
